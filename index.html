<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>מחסן מינימלי — חיפוש מק״ט למיקום</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--bg:#f7f7fb;--card:#fff;--accent:#2563eb;--text:#0f172a}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text)}
    .wrap{max-width:680px;margin:40px auto;padding:16px}
    .card{background:var(--card);border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,.06);padding:20px}
    h1{font-size:22px;margin:0 0 12px}
    p.note{margin:0 0 16px;color:#475569}
    label{display:block;margin:10px 0 6px}
    input,button{font:inherit}
    input[type=text]{width:100%;padding:12px 14px;border:1px solid #e2e8f0;border-radius:12px;outline:none}
    input[type=text]:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1}
    button{padding:12px 14px;border:none;border-radius:12px;cursor:pointer}
    .primary{background:var(--accent);color:#fff}
    .ghost{background:#eef2ff;color:#1e293b}
    .danger{background:#ef4444;color:#fff}
    .muted{color:#64748b}
    .result{margin-top:14px;padding:12px 14px;background:#ecfeff;border:1px solid #bae6fd;border-radius:12px}
    .list{margin-top:20px}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden}
    th,td{padding:10px 12px;border-bottom:1px solid #e2e8f0;text-align:right}
    th{background:#eef2ff}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:#e2e8f0;padding:2px 6px;border-radius:6px}
    .flex{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .pill{display:inline-block;padding:4px 10px;background:#f1f5f9;border-radius:999px;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>מחסן מינימלי</h1>
      <p class="note">מקלידים מק״ט (4–5 ספרות) ➜ מקבלים את המיקום. אפשר להוסיף/לעדכן.</p>

      <label>חיפוש מק״ט</label>
      <div class="row">
        <input id="searchSku" type="text" inputmode="numeric" pattern="\\d{4,5}" placeholder="לדוגמה: 1234" autofocus>
        <button class="primary" id="btnSearch">חפש</button>
      </div>
      <div id="searchResult" class="result" style="display:none"></div>

      <hr style="margin:20px 0;border:none;border-top:1px solid #e2e8f0">

      <div class="flex">
        <h2 style="margin:0;font-size:18px">הוספה/עדכון</h2>
        <span class="pill muted">נשמר מקומית בדפדפן (localStorage)</span>
      </div>

      <label>מק״ט (4–5 ספרות)</label>
      <input id="formSku" type="text" inputmode="numeric" pattern="\\d{4,5}" placeholder="לדוגמה: 12345">
      <label>מיקום (לדוגמה: A1-03 או מדף 12)</label>
      <div class="row">
        <input id="formLoc" type="text" placeholder="לדוגמה: A1-03">
        <button class="ghost" id="btnAdd">הוסף חדש</button>
        <button class="primary" id="btnUpdate">עדכן מיקום</button>
      </div>
      <div id="formMsg" class="result" style="display:none"></div>

      <div class="list">
        <div class="flex">
          <h3 style="margin:0;font-size:16px">רשימת מק״טים</h3>
          <div>
            <button class="ghost" id="btnExport">ייצוא</button>
            <button class="ghost" id="btnImport">ייבוא</button>
            <button class="danger" id="btnWipe">נקה הכל</button>
          </div>
        </div>
        <table id="table">
          <thead><tr><th>מק״ט</th><th>מיקום</th><th>פעולות</th></tr></thead>
          <tbody id="tbody"><tr><td colspan="3" class="muted">אין נתונים עדיין</td></tr></tbody>
        </table>
      </div>

      <p class="muted" style="margin-top:12px">טיפ: סורק ברקוד שמקליד מספרים יפעל כאן ישר, רק תן ל־<span class="kbd">חיפוש מק״ט</span> פוקוס.</p>
    </div>
  </div>

<script>
(function(){
  const KEY = "warehouseMiniDB"; // array of {sku, loc}
  const $ = sel => document.querySelector(sel);
  const $$ = sel => document.querySelectorAll(sel);

  const searchSku = $("#searchSku");
  const btnSearch = $("#btnSearch");
  const searchResult = $("#searchResult");
  const formSku = $("#formSku");
  const formLoc = $("#formLoc");
  const btnAdd = $("#btnAdd");
  const btnUpdate = $("#btnUpdate");
  const formMsg = $("#formMsg");
  const tbody = $("#tbody");
  const btnExport = $("#btnExport");
  const btnImport = $("#btnImport");
  const btnWipe = $("#btnWipe");

  const load = () => {
    try { return JSON.parse(localStorage.getItem(KEY)) || []; }
    catch(e){ return []; }
  };
  const save = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));
  const normalizeSku = (v) => (v||"").trim();
  const validSku = (v) => /^\d{4,5}$/.test(v);

  function render(){
    const data = load().sort((a,b)=>a.sku.localeCompare(b.sku));
    tbody.innerHTML = "";
    if(!data.length){
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 3;
      td.textContent = "אין נתונים עדיין";
      td.className = "muted";
      tr.appendChild(td);
      tbody.appendChild(tr);
      return;
    }
    for(const row of data){
      const tr = document.createElement("tr");
      const tdSku = document.createElement("td");
      const tdLoc = document.createElement("td");
      const tdAct = document.createElement("td");
      tdSku.textContent = row.sku;
      tdLoc.textContent = row.loc;
      const copyBtn = document.createElement("button");
      copyBtn.textContent = "העתק";
      copyBtn.className = "ghost";
      copyBtn.onclick = async ()=> {
        await navigator.clipboard.writeText(row.loc);
        toast(`הועתק: ${row.loc}`);
      };
      const delBtn = document.createElement("button");
      delBtn.textContent = "מחק";
      delBtn.className = "danger";
      delBtn.onclick = ()=> {
        const arr = load().filter(x=>x.sku!==row.sku);
        save(arr); render(); toast("נמחק");
      };
      tdAct.append(copyBtn, " ", delBtn);
      tr.append(tdSku, tdLoc, tdAct);
      tbody.appendChild(tr);
    }
  }

  function toast(msg){
    formMsg.style.display = "block";
    formMsg.textContent = msg;
    setTimeout(()=>{ formMsg.style.display = "none"; }, 1500);
  }

  function doSearch(){
    const sku = normalizeSku(searchSku.value);
    if(!validSku(sku)){
      searchResult.style.display = "block";
      searchResult.textContent = "מק״ט לא תקין — צריך 4–5 ספרות.";
      return;
    }
    const hit = load().find(x=>x.sku===sku);
    searchResult.style.display = "block";
    searchResult.textContent = hit ? `המיקום של ${sku}: ${hit.loc}` : `לא נמצא מק״ט ${sku}.`;
  }

  function addNew(){
    const sku = normalizeSku(formSku.value);
    const loc = (formLoc.value||"").trim();
    if(!validSku(sku)) return toast("מק״ט לא תקין (4–5 ספרות).");
    if(!loc) return toast("צריך למלא מיקום.");
    const arr = load();
    if(arr.some(x=>x.sku===sku)) return toast("קיים כבר מק״ט כזה. השתמש בעדכון.");
    arr.push({sku, loc});
    save(arr); render(); toast("נוסף בהצלחה.");
  }

  function updateLoc(){
    const sku = normalizeSku(formSku.value);
    const loc = (formLoc.value||"").trim();
    if(!validSku(sku)) return toast("מק״ט לא תקין (4–5 ספרות).");
    if(!loc) return toast("צריך למלא מיקום.");
    const arr = load();
    const idx = arr.findIndex(x=>x.sku===sku);
    if(idx<0) return toast("לא קיים מק״ט כזה. הוסף חדש.");
    arr[idx].loc = loc;
    save(arr); render(); toast("עודכן בהצלחה.");
  }

  btnSearch.addEventListener("click", doSearch);
  searchSku.addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); doSearch(); } });

  btnAdd.addEventListener("click", (e)=>{ e.preventDefault(); addNew(); });
  btnUpdate.addEventListener("click", (e)=>{ e.preventDefault(); updateLoc(); });

  btnExport.addEventListener("click", ()=>{
    const data = load();
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "warehouse-mini.json"; a.click();
    URL.revokeObjectURL(url);
  });

  btnImport.addEventListener("click", ()=>{
    const inp = document.createElement("input");
    inp.type = "file"; inp.accept = "application/json";
    inp.onchange = ()=> {
      const file = inp.files[0];
      if(!file) return;
      const fr = new FileReader();
      fr.onload = ()=> {
        try{
          const data = JSON.parse(fr.result);
          if(!Array.isArray(data)) throw new Error("פורמט לא תקין");
          // keep only valid rows
          const clean = [];
          for(const r of data){
            if(r && typeof r.sku==="string" && typeof r.loc==="string" && validSku(r.sku) && r.loc.trim()){
              clean.push({sku:r.sku.trim(), loc:r.loc.trim()});
            }
          }
          save(clean); render(); toast("ייבוא הושלם.");
        }catch(e){ toast("שגיאה בייבוא."); }
      };
      fr.readAsText(file);
    };
    inp.click();
  });

  btnWipe.addEventListener("click", ()=>{
    if(confirm("למחוק את כל הנתונים המקומיים?")){
      save([]); render(); toast("נוקה.");
    }
  });

  // Optional seed with query ?seed=1 for demo
  const params = new URLSearchParams(location.search);
  if(params.get("seed")==="1" && load().length===0){
    save([{sku:"1234",loc:"A1-03"},{sku:"5678",loc:"B2-11"}]);
  }

  render();
})();
</script>
</body>
</html>
